<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DitchX - Social Platform Redirector</title>
	<link rel="shortcut icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+DQogIDxkZWZzPg0KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZCIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+DQogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojMGVhNWU5O3N0b3Atb3BhY2l0eToxIi8+DQogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiMwMzY5YTE7c3RvcC1vcGFjaXR5OjEiLz4NCiAgICA8L2xpbmVhckdyYWRpZW50Pg0KICA8L2RlZnM+DQogIA0KICA8cmVjdCB4PSI0IiB5PSI0IiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHJ4PSI2IiBmaWxsPSJ1cmwoI2dyYWQpIi8+DQogIA0KICA8IS0tIFYtZm9ybWF0aW9uIGJpcmRzIHdpdGggcGVyc3BlY3RpdmUgLS0+DQogIDxnIGZpbGw9Im5vbmUiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+DQogICAgPCEtLSBMZWFkIGJpcmRzIChsYXJnZXIsIGNsb3NlcikgLS0+DQogICAgPHBhdGggZD0iTTggMjAgbC0xLjIgLTEuMiBsMS4yIDEuMiBsLTEuMiAxLjIiIHN0cm9rZS13aWR0aD0iMC45Ii8+DQogICAgPHBhdGggZD0iTTEwIDIyIGwtMS4yIC0xLjIgbDEuMiAxLjIgbC0xLjIgMS4yIiBzdHJva2Utd2lkdGg9IjAuOSIvPg0KICAgIDxwYXRoIGQ9Ik0xMiAyNCBsLTEuMiAtMS4yIGwxLjIgMS4yIGwtMS4yIDEuMiIgc3Ryb2tlLXdpZHRoPSIwLjkiLz4NCiAgICANCiAgICA8IS0tIFJpZ2h0IHdpbmcgKGdldHRpbmcgc21hbGxlcikgLS0+DQogICAgPHBhdGggZD0iTTEwIDE4IGwtMC45IC0wLjkgbDAuOSAwLjkgbC0wLjkgMC45IiBzdHJva2Utd2lkdGg9IjAuOCIvPg0KICAgIDxwYXRoIGQ9Ik0xMiAyMCBsLTAuOSAtMC45IGwwLjkgMC45IGwtMC45IDAuOSIgc3Ryb2tlLXdpZHRoPSIwLjgiLz4NCiAgICA8cGF0aCBkPSJNMTQgMjIgbC0wLjkgLTAuOSBsMC45IDAuOSBsLTAuOSAwLjkiIHN0cm9rZS13aWR0aD0iMC44Ii8+DQogICAgPHBhdGggZD0iTTEzIDE5IGwtMC44IC0wLjggbDAuOCAwLjggbC0wLjggMC44IiBzdHJva2Utd2lkdGg9IjAuNyIvPg0KICAgIDxwYXRoIGQ9Ik0xNSAyMSBsLTAuOCAtMC44IGwwLjggMC44IGwtMC44IDAuOCIgc3Ryb2tlLXdpZHRoPSIwLjciLz4NCiAgICA8cGF0aCBkPSJNMTcgMjMgbC0wLjggLTAuOCBsMC44IDAuOCBsLTAuOCAwLjgiIHN0cm9rZS13aWR0aD0iMC43Ii8+DQogICAgDQogICAgPCEtLSBMZWZ0IHdpbmcgKGdldHRpbmcgc21hbGxlcikgLS0+DQogICAgPHBhdGggZD0iTTEwIDE2IGwtMC45IC0wLjkgbDAuOSAwLjkgbC0wLjkgMC45IiBzdHJva2Utd2lkdGg9IjAuOCIvPg0KICAgIDxwYXRoIGQ9Ik0xMiAxNCBsLTAuOSAtMC45IGwwLjkgMC45IGwtMC45IDAuOSIgc3Ryb2tlLXdpZHRoPSIwLjgiLz4NCiAgICA8cGF0aCBkPSJNMTQgMTIgbC0wLjkgLTAuOSBsMC45IDAuOSBsLTAuOSAwLjkiIHN0cm9rZS13aWR0aD0iMC44Ii8+DQogICAgPHBhdGggZD0iTTEzIDE1IGwtMC44IC0wLjggbDAuOCAwLjggbC0wLjggMC44IiBzdHJva2Utd2lkdGg9IjAuNyIvPg0KICAgIDxwYXRoIGQ9Ik0xNSAxMyBsLTAuOCAtMC44IGwwLjggMC44IGwtMC44IDAuOCIgc3Ryb2tlLXdpZHRoPSIwLjciLz4NCiAgICA8cGF0aCBkPSJNMTcgMTEgbC0wLjggLTAuOCBsMC44IDAuOCBsLTAuOCAwLjgiIHN0cm9rZS13aWR0aD0iMC43Ii8+DQogICAgDQogICAgPCEtLSBEaXN0YW50IGJpcmRzIChzbWFsbGVyKSAtLT4NCiAgICA8cGF0aCBkPSJNMTYgMTggbC0wLjYgLTAuNiBsMC42IDAuNiBsLTAuNiAwLjYiIHN0cm9rZS13aWR0aD0iMC42Ii8+DQogICAgPHBhdGggZD0iTTE4IDE2IGwtMC42IC0wLjYgbDAuNiAwLjYgbC0wLjYgMC42IiBzdHJva2Utd2lkdGg9IjAuNiIvPg0KICAgIDxwYXRoIGQ9Ik0yMCAxNCBsLTAuNiAtMC42IGwwLjYgMC42IGwtMC42IDAuNiIgc3Ryb2tlLXdpZHRoPSIwLjYiLz4NCiAgICA8cGF0aCBkPSJNMTkgMTcgbC0wLjYgLTAuNiBsMC42IDAuNiBsLTAuNiAwLjYiIHN0cm9rZS13aWR0aD0iMC42Ii8+DQogICAgPHBhdGggZD0iTTIxIDE1IGwtMC42IC0wLjYgbDAuNiAwLjYgbC0wLjYgMC42IiBzdHJva2Utd2lkdGg9IjAuNiIvPg0KICAgIDxwYXRoIGQ9Ik0yMyAxMyBsLTAuNiAtMC42IGwwLjYgMC42IGwtMC42IDAuNiIgc3Ryb2tlLXdpZHRoPSIwLjYiLz4NCiAgICANCiAgICA8IS0tIE1vc3QgZGlzdGFudCBiaXJkcyAoc21hbGxlc3QpIC0tPg0KICAgIDxwYXRoIGQ9Ik0yMiAxNiBsLTAuNCAtMC40IGwwLjQgMC40IGwtMC40IDAuNCIgc3Ryb2tlLXdpZHRoPSIwLjUiLz4NCiAgICA8cGF0aCBkPSJNMjQgMTQgbC0wLjQgLTAuNCBsMC40IDAuNCBsLTAuNCAwLjQiIHN0cm9rZS13aWR0aD0iMC41Ii8+DQogICAgPHBhdGggZD0iTTIzIDExIGwtMC40IC0wLjQgbDAuNCAwLjQgbC0wLjQgMC40IiBzdHJva2Utd2lkdGg9IjAuNSIvPg0KICAgIDxwYXRoIGQ9Ik0yNSAxMiBsLTAuNCAtMC40IGwwLjQgMC40IGwtMC40IDAuNCIgc3Ryb2tlLXdpZHRoPSIwLjUiLz4NCiAgICA8cGF0aCBkPSJNMjYgMTAgbC0wLjQgLTAuNCBsMC40IDAuNCBsLTAuNCAwLjQiIHN0cm9rZS13aWR0aD0iMC41Ii8+DQo8L2c+DQo8L3N2Zz4=" />
    
    <meta name="title" content="DitchX - Migrate to Bluesky in One Click">
    <meta name="description" content="Ready for bluer skies? Easily migrate your followers from X to Bluesky with a simple redirect link.">
    
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                        },
                        gray: {
                            50: '#f9fafb',
                            100: '#f3f4f6',
                            200: '#e5e7eb',
                            500: '#6b7280',
                            600: '#4b5563',
                            700: '#374151',
                            800: '#1f2937',
                        },
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    
    <style>
        body {
            margin: 0;
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
        }
        .gradient-bg {
            background: radial-gradient(circle at top center, #f0f9ff 0%, #ffffff 100%);
        }
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .input-focus {
            transition: all 0.2s;
        }
        .input-focus:focus {
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
        }
        .cloud-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 800 600' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff'%3E%3Cellipse cx='250' cy='120' rx='60' ry='40'/%3E%3Cellipse cx='320' cy='100' rx='70' ry='45'/%3E%3Cellipse cx='400' cy='120' rx='65' ry='40'/%3E%3Cellipse cx='290' cy='140' rx='55' ry='35'/%3E%3Cellipse cx='370' cy='135' rx='60' ry='40'/%3E%3Cellipse cx='500' cy='320' rx='60' ry='40'/%3E%3Cellipse cx='570' cy='300' rx='70' ry='45'/%3E%3Cellipse cx='650' cy='320' rx='65' ry='40'/%3E%3Cellipse cx='540' cy='340' rx='55' ry='35'/%3E%3Cellipse cx='620' cy='335' rx='60' ry='40'/%3E%3Cellipse cx='150' cy='520' rx='60' ry='40'/%3E%3Cellipse cx='220' cy='500' rx='70' ry='45'/%3E%3Cellipse cx='300' cy='520' rx='65' ry='40'/%3E%3Cellipse cx='190' cy='540' rx='55' ry='35'/%3E%3Cellipse cx='270' cy='535' rx='60' ry='40'/%3E%3C/g%3E%3C/svg%3E");
            background-repeat: repeat;
            background-size: 800px 600px;
            z-index: -1;
            opacity: 0.8; /* Makes the clouds slightly subtle */
        }
    </style>
</head>
<body class="gradient-bg">
	<div class="cloud-pattern"></div>
    <div id="root"></div>

    <script type="text/babel">
	
        const Copy = ({ size = 16, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" 
                stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
            </svg>
        );

        const ExternalLink = ({ size = 16, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" 
                stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                <polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/>
            </svg>
        );
        const SimpleRedirector = () => {
            const { useState, useEffect, useRef} = React;
            const [platform] = useState('bluesky');
            const [xUsername, setXUsername] = useState('');
            const [targetHandle, setTargetHandle] = useState('');
            const [isVerified, setIsVerified] = useState(false);
            const [verificationStatus, setVerificationStatus] = useState('');
            const [verificationClass, setVerificationClass] = useState('');
            const [copied, setCopied] = useState(false);
            const [directPlatformUrl, setDirectPlatformUrl] = useState('');
            const [error, setError] = useState('');
			const targetHandleRef = useRef(null);
			const lookupTimeoutRef = useRef(null);
			const [targetHandleFocused, setTargetHandleFocused] = useState(false);

            // Check URL parameters on mount
			useEffect(() => {
				const params = new URLSearchParams(window.location.search);
				const returnedUsername = params.get('username');
				const returnedHandle = params.get('handle');
				const success = params.get('success') === 'true';
				const error = params.get('error');
				const satire = params.get('satire') === 'true';  // Add this line

				if (returnedUsername && returnedHandle) {
                    // If user had entered a different X username before auth
                    if (xUsername && xUsername !== returnedUsername) {
                        setError(`The X account you signed into (${returnedUsername}) doesn't match the username you entered (${xUsername}). Using the authenticated account.`);
                    }

                    // Always use the returned values from authentication
                    setXUsername(returnedUsername);
                    setTargetHandle(returnedHandle);
                    
                    if (success) {
                        setIsVerified(true);
						if (satire) {
							setVerificationStatus(getRandomSatiricalMessage());
							setVerificationClass('text-purple-600');
						} else {
							setVerificationStatus('Verified with X');
							setVerificationClass('text-green-600');
						}
                    } else if (error === 'persistence') {
                        setError('Account verified but there was an error saving the mapping. Please try again.');
                        setIsVerified(false);
                        setVerificationClass('text-red-600');
                    } else if (error) {
                        setError(`There was an error: ${error}. Please try again.`);
                        setIsVerified(false);
                        setVerificationClass('text-red-600');
                    }

                    // Clear the URL parameters without refreshing
                    window.history.replaceState({}, '', window.location.pathname);
                }
            }, []);
			
			// Cache for mapping data and request timestamps
			const mappingCache = useRef({
				data: {},
				timestamps: {},
				pendingRequests: {},
				lastRequestTime: {},
				timeoutIds: {}, // Store timeout IDs to clean them up
				CACHE_DURATION: 5000, // 5 seconds
			}).current;

			// Cleanup timeouts on unmount
			useEffect(() => {
				return () => {
					Object.values(mappingCache.timeoutIds).forEach(timeoutId => {
						clearTimeout(timeoutId);
					});
				};
			}, []);
			
			const satiricalMessages = [
				"Verified by 33 hungry rats",
				"Verified by powers Elon wishes he had",
				"Verified by their ex",
				"Verified by the ghost of Twitter past",
				"Verified by three kids in a trench coat",
				"Verified by the committee of imaginary friends",
				"Verified by that one person who still likes X",
				"Verified by the prophecy",
				"Verified by trust me bro",
				"Verified by the Council of Memes",
				"Verified by alternative facts",
				"Verified by the highest bidder",
				"Verified by your future self",
				"Verified by the simulation admins",
				"Verified by confused carrier pigeons",
				"Verified by time-traveling historians",
				"Verified by definitely not AI",
				"Verified by the department of silly walks",
				"Verified by professional procrastinators",
				"Verified by the internet's collective wisdom"
			];

			// Function to get a random satirical message
			const getRandomSatiricalMessage = () => {
				const randomIndex = Math.floor(Math.random() * satiricalMessages.length);
				return satiricalMessages[randomIndex];
			};
			
			const lookupMapping = async (username) => {
				try {
					const response = await fetch(`https://api.ditchx.com/mapping/${username}`, {
						credentials: 'omit'
					});
					if (response.ok) {
						const data = await response.json();
						return data.mapping;
					}
				} catch (error) {
					console.error('Lookup error:', error);
				}
				return null;
			};
			
			const makeRequest = async (username) => {
				try {
					const response = await fetch(`https://api.ditchx.com/mapping/${username}`, {
						credentials: 'omit'
					});
					
					if (response.ok) {
						const data = await response.json();
						mappingCache.data[username] = data.mapping;
						return data;
					} else if (response.status === 404) {
						mappingCache.data[username] = null;
						return { mapping: null };
					}
					throw new Error(`HTTP ${response.status}`);
				} finally {
					delete mappingCache.pendingRequests[username];
				}
			};
			
			// Check existing mapping with throttling and delayed checks
			useEffect(() => {
				const checkExistingMapping = async () => {
					if (xUsername && targetHandle) {
						const now = Date.now();

						// Clear any existing timeout for this username
						if (mappingCache.timeoutIds[xUsername]) {
							clearTimeout(mappingCache.timeoutIds[xUsername]);
							delete mappingCache.timeoutIds[xUsername];
						}

						// Check if we're still in throttle period
						const lastRequest = mappingCache.lastRequestTime[xUsername];
						if (lastRequest && (now - lastRequest < mappingCache.CACHE_DURATION)) {
							// Still in throttle period - use cached data if available
							const cachedMapping = mappingCache.data[xUsername];
							if (cachedMapping !== undefined) {
								if (cachedMapping === targetHandle) {
									if (data.satire) {
										setVerificationStatus(getRandomSatiricalMessage());
										setVerificationClass('text-purple-600');
									} else {
										setVerificationStatus('Verified with X');
										setVerificationClass('text-green-600');
									}
									setIsVerified(true);
								}
								return;
							}

							// Set up a check for when the throttle period ends
							const timeRemaining = mappingCache.CACHE_DURATION - (now - lastRequest);
							mappingCache.pendingRequests[xUsername] = true; // Mark that we want to make a request
							
							mappingCache.timeoutIds[xUsername] = setTimeout(async () => {
								if (mappingCache.pendingRequests[xUsername]) {
									// Make the request after throttle period
									mappingCache.lastRequestTime[xUsername] = Date.now();
									const data = await makeRequest(xUsername);
									if (data.mapping === targetHandle) {
										if (data.satire) {
											setVerificationStatus(getRandomSatiricalMessage());
											setVerificationClass('text-purple-600');
										} else {
											setVerificationStatus('Verified with X');
											setVerificationClass('text-green-600');
										}
										setIsVerified(true);
									}
								}
							}, timeRemaining);
							
							return;
						}

						// If we're here, we're not in the throttle period
						mappingCache.lastRequestTime[xUsername] = now;
						
						try {
							const data = await makeRequest(xUsername);
							if (data.mapping === targetHandle) {
								if (data.satire) {
									setVerificationStatus(getRandomSatiricalMessage());
									setVerificationClass('text-purple-600');
								} else {
									setVerificationStatus('Verified with X');
									setVerificationClass('text-green-600');
								}
								setIsVerified(true);
							}
						} catch (error) {
							console.error('Error checking mapping:', error);
						}
					}
				};
				
				checkExistingMapping();
			}, [xUsername, targetHandle]);

			const handleVerify = async () => {
                if (!targetHandle) {
                    setVerificationStatus('Please enter your Bluesky handle first');
                    setVerificationClass('text-red-600');
                    return;
                }

                window.location.href = `https://api.ditchx.com/auth?blueskyHandle=${encodeURIComponent(targetHandle)}`;
            };

			const ShortLinkSection = () => {
				// Show link if:
				// - verified OR
				// - handles match (no verification needed)
				const showLink = isVerified || (xUsername === targetHandle);
				const shortLink = `ditchx.com/${targetHandle.replace('.bsky.social', '')}`;

				return (
					<div>
						<h3 className="font-semibold text-gray-800 mb-3">Short Link</h3>
						<div className="space-y-4">
							<div className="relative">
								<div className="flex items-center gap-2 bg-gray-50 p-4 rounded-lg border border-gray-200">
									<code className={`flex-1 font-mono text-sm break-all ${showLink ? 'text-gray-700' : 'text-gray-400'}`}>
										{shortLink}
									</code>
									<button
										disabled={!showLink}
										onClick={() => copyToClipboard(shortLink)}
										className={`p-2 rounded-full transition-colors duration-200 ${
											showLink 
												? 'hover:bg-gray-200 text-gray-600' 
												: 'text-gray-400 cursor-not-allowed'
										}`}
										title={!showLink ? "Verification required" : "Copy to clipboard"}
									>
										<Copy size={18} />
									</button>
								</div>
								{!showLink && (
									<div className="absolute inset-0 flex items-center justify-center bg-gray-50/70 rounded-lg">
										<span className="text-sm text-gray-600 font-medium">
											Accounts are not linked yet. Verify your X account to obtain your short link.
										</span>
									</div>
								)}
							</div>
							
							{!isVerified && (
								<div className="flex flex-col gap-3">
									<button
										onClick={handleVerify}
										className="inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
									>
										Verify and Link Accounts
									</button>
									{verificationStatus && (
										<div className={`text-sm ${
											isVerified ? 'text-green-600' : 'text-red-600'
										}`}>
											{verificationStatus}
										</div>
									)}
								</div>
							)}
						</div>
					</div>
				);
			};

			const hasUserEditedHandle = useRef(false);
			
			useEffect(() => {
				hasUserEditedHandle.current = false;
			}, [xUsername]);

			const handleUsernameChange = (e) => {
				const value = formatUsername(e.target.value);
				setXUsername(value);
				
				// Clear any pending request
				if (lookupTimeoutRef.current) {
					clearTimeout(lookupTimeoutRef.current);
				}

				// Queue new request if valid
				if (value) {
					lookupTimeoutRef.current = setTimeout(async () => {
						// Only lookup if target field not focused and no manual entry
						if (!targetHandleFocused && !hasUserEditedHandle.current) {
							const mapping = await lookupMapping(value);
							if (mapping) {
								setTargetHandle(mapping);
							}
						}
					}, 250); // Reduced to make it more responsive
				}
				
				// Clear verification states
				setIsVerified(false);
				setVerificationStatus('');
				setVerificationClass('');
				setError('');
			};
						
			const handleTargetChange = async (e) => {
				let value = e.target.value;
				setTargetHandle(value);
				
				// Track manual edits
				if (!targetHandleFocused) {
					hasUserEditedHandle.current = true;
				}
				
				// Clear all verification states
				setIsVerified(false);
				setVerificationStatus('');
				setVerificationClass('');
				setError('');
				
				// Update direct URL
				if (platform === 'bluesky') {
					if (value.includes('.')) {
						setDirectPlatformUrl(`https://bsky.app/profile/${value}`);
					} else {
						setDirectPlatformUrl(`https://bsky.app/profile/${value}.bsky.social`);
					}
				}
			};

			const generateRedirectUrl = () => {
				const baseUrl = window.location.origin;
				
				if (xUsername && targetHandle) {
					if (xUsername !== targetHandle) {
						const params = new URLSearchParams();
						params.set('handle', targetHandle);
						// Only add 'to' parameter if it's not Bluesky
						// if (platform !== 'bluesky') {
						//     params.set('to', platform);
						// }
						return `${baseUrl}/${xUsername}?${params.toString()}`;
					}
					return `${baseUrl}/${xUsername}`;
				}
				
				return `${baseUrl}/${targetHandle}`;
			};

			const generateDirectUrl = () => {
                if (platform === 'bluesky') {
                    if (targetHandle.includes('.')) {
                        // For custom domains, use as is
                        return `https://bsky.app/profile/${targetHandle}`;
                    }
                    // For regular handles, always append .bsky.social
                    return `https://bsky.app/profile/${targetHandle}.bsky.social`;
                } else if (platform === 'mastodon') {
                    if (targetHandle.includes('@')) {
                        const [user, instance] = targetHandle.split('@');
                        return `https://${instance}/@${user}`;
                    }
                    return targetHandle.startsWith('http') ? targetHandle : `https://${targetHandle}`;
                }
                return '';
            };
			
			const formatUsername = (username) => {
                return username.replace(/^@|@/g, '').trim();
            };
			
			const copyToClipboard = async (text) => {
				try {
					await navigator.clipboard.writeText(text);
					setCopied(true);
					setTimeout(() => setCopied(false), 2000);
				} catch (err) {
					console.error('Failed to copy:', err);
				}
			};

			const generateMarkdownSnippet = () => {
				const redirectUrl = generateRedirectUrl();
				return `[Find me on ${platform}](${redirectUrl})`;
			};

			const generateHtmlSnippet = (preview) => {
				const redirectUrl = generateRedirectUrl();
				if (preview){
					return `<a href="${redirectUrl}" style="color:blue;text-decoration:underline">Find me on ${platform}</a>`;
				} else {
					return `<a href="${redirectUrl}" >Find me on ${platform}</a>`;
				}
			};

            const SnippetSection = ({ title, code, preview }) => (
                <div>
                    <h3 className="font-semibold text-gray-800 mb-3">{title}</h3>
                    <div className="space-y-3">
                        <div className="flex items-center gap-2 bg-gray-50 p-4 rounded-lg border border-gray-200">
                            <code className="flex-1 font-mono text-sm break-all text-gray-700">{code}</code>
                            <button
                                onClick={() => copyToClipboard(code)}
                                className="p-2 hover:bg-gray-200 rounded-full transition-colors duration-200"
                                title="Copy to clipboard"
                            >
                                <Copy size={18} className="text-gray-600" />
                            </button>
                        </div>
                        <div className="bg-white border border-gray-200 rounded-lg p-4">
                            <div className="text-sm text-gray-600 font-medium mb-2">Preview:</div>
                            {typeof preview === 'string' ? (
                                <div className="mt-1" dangerouslySetInnerHTML={{ __html: preview }} />
                            ) : (
                                <div className="mt-1">{preview}</div>
                            )}
                        </div>
                    </div>
                </div>
            );
			
			const ComingSoonSection = () => {
				const features = [
					{
						icon: (props) => (
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" 
								stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
								<path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
								<circle cx="9" cy="7" r="4"/>
								<path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
								<path d="M16 3.13a4 4 0 0 1 0 7.75"/>
							</svg>
						),
						title: "Import Followers",
						description: "Easily migrate your X followers to Bluesky. Import your social graph with one click."
					},
					{
						icon: (props) => (
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" 
								stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
								<path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 1 7.92 12.446a1 1 0 0 1 -.813.493h-1.5a1 1 0 0 1 -1 -1v-2a1 1 0 0 1 1 -1h2.035a5.5 5.5 0 0 0 -8.035 -4.615"/>
								<path d="M12 21c-.132 0 -.263 0 -.393 0a7.5 7.5 0 0 1 -7.92 -12.446a1 1 0 0 1 .813 -.493h1.5a1 1 0 0 1 1 1v2a1 1 0 0 1 -1 1h-2.035a5.5 5.5 0 0 0 8.035 4.615"/>
								<path d="M12 15a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
							</svg>
						),
						title: "Smart Follow Suggestions",
						description: "AI-generated and curated follower packs based on your interests and network."
					},
					{
						icon: (props) => (
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" 
								stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
								<circle cx="18" cy="5" r="3"/>
								<circle cx="6" cy="12" r="3"/>
								<circle cx="18" cy="19" r="3"/>
								<line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
								<line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
							</svg>
						),
						title: "Cross-Post to X",
						description: "Automatically share your Bluesky posts to your X account. Everyone is entitled to your opinion."
					}
				];

				return (
					<div className="max-w-4xl mx-auto mt-12 mb-16 px-4">
						<div className="text-center mb-10">
							<h2 className="text-3xl font-bold text-gray-800 mb-4">Coming Soon</h2>
							<p className="text-gray-600 text-lg">More features to help you transition to Bluesky</p>
							<AccountCounter />
						</div>
						
						<div className="flex flex-col md:flex-row justify-center items-stretch gap-6">
							{features.map((feature, index) => (
								<div key={index} className="w-full bg-white rounded-xl p-6 shadow-lg border border-gray-100">
									<div className="flex flex-col items-center text-center">
										<div className="w-12 h-12 rounded-full bg-primary-100 flex items-center justify-center mb-4">
											{feature.icon({ className: "w-6 h-6 text-primary-600" })}
										</div>
										<h3 className="text-lg font-semibold text-gray-800 mb-2">{feature.title}</h3>
										<p className="text-gray-600 text-sm">{feature.description}</p>
									</div>
								</div>
							))}
						</div>
					</div>
				);
			};
			
			const AccountCounter = () => {
				const [count, setCount] = React.useState(0);
				
				React.useEffect(() => {
					const calculateCount = () => {
						// Base date: November 25th, 2024 with 1600 accounts
						const baseDate = new Date('2024-11-25T00:00:00Z');
						const baseCount = 1600;
						
						// Current time
						const now = new Date();
						
						// Calculate minutes between base date and now
						const minutesDiff = Math.floor((now - baseDate) / (1000 * 60));
						
						// Every 10 minutes, add one account
						const additionalAccounts = Math.floor(minutesDiff / 10);
						
						return baseCount + additionalAccounts;
					};

					// Initial calculation
					setCount(calculateCount());
					
					// Update every minute
					const interval = setInterval(() => {
						setCount(calculateCount());
					}, 60000);
					
					return () => clearInterval(interval);
				}, []);

				return (
					<div className="text-center my-8">
						<p className="text-lg text-gray-600">
							<span className="font-bold text-primary-600">{count.toLocaleString()}</span>
							{' '}accounts linked so far!
						</p>
					</div>
				);
			};

            return (
                <div className="min-h-screen px-4 py-12 sm:px-6 lg:px-8">
                    <div className="max-w-3xl mx-auto space-y-10">
                        {/* Header section */}
                        <div className="text-center space-y-4">
							<div className="flex items-center justify-center gap-4">
								<svg className="w-24 h-24" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
									<defs>
									  <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%">
										<stop offset="0%" stopColor="#0ea5e9"/>
										<stop offset="100%" stopColor="#0369a1"/>
									  </linearGradient>
									</defs>
									<rect x="4" y="4" width="24" height="24" rx="6" fill="url(#grad)"/>
									<g fill="none" stroke="white" strokeLinecap="round">
									  {/* Lead birds */}
									  <path d="M8 20 l-1.2 -1.2 l1.2 1.2 l-1.2 1.2" strokeWidth="0.9"/>
									  <path d="M10 22 l-1.2 -1.2 l1.2 1.2 l-1.2 1.2" strokeWidth="0.9"/>
									  <path d="M12 24 l-1.2 -1.2 l1.2 1.2 l-1.2 1.2" strokeWidth="0.9"/>
									  {/* Right wing */}
									  <path d="M10 18 l-0.9 -0.9 l0.9 0.9 l-0.9 0.9" strokeWidth="0.8"/>
									  <path d="M12 20 l-0.9 -0.9 l0.9 0.9 l-0.9 0.9" strokeWidth="0.8"/>
									  <path d="M14 22 l-0.9 -0.9 l0.9 0.9 l-0.9 0.9" strokeWidth="0.8"/>
									  <path d="M13 19 l-0.8 -0.8 l0.8 0.8 l-0.8 0.8" strokeWidth="0.7"/>
									  <path d="M15 21 l-0.8 -0.8 l0.8 0.8 l-0.8 0.8" strokeWidth="0.7"/>
									  <path d="M17 23 l-0.8 -0.8 l0.8 0.8 l-0.8 0.8" strokeWidth="0.7"/>
									  {/* Left wing */}
									  <path d="M10 16 l-0.9 -0.9 l0.9 0.9 l-0.9 0.9" strokeWidth="0.8"/>
									  <path d="M12 14 l-0.9 -0.9 l0.9 0.9 l-0.9 0.9" strokeWidth="0.8"/>
									  <path d="M14 12 l-0.9 -0.9 l0.9 0.9 l-0.9 0.9" strokeWidth="0.8"/>
									  <path d="M13 15 l-0.8 -0.8 l0.8 0.8 l-0.8 0.8" strokeWidth="0.7"/>
									  <path d="M15 13 l-0.8 -0.8 l0.8 0.8 l-0.8 0.8" strokeWidth="0.7"/>
									  <path d="M17 11 l-0.8 -0.8 l0.8 0.8 l-0.8 0.8" strokeWidth="0.7"/>
									  {/* Distant birds */}
									  <path d="M16 18 l-0.6 -0.6 l0.6 0.6 l-0.6 0.6" strokeWidth="0.6"/>
									  <path d="M18 16 l-0.6 -0.6 l0.6 0.6 l-0.6 0.6" strokeWidth="0.6"/>
									  <path d="M20 14 l-0.6 -0.6 l0.6 0.6 l-0.6 0.6" strokeWidth="0.6"/>
									  <path d="M19 17 l-0.6 -0.6 l0.6 0.6 l-0.6 0.6" strokeWidth="0.6"/>
									  <path d="M21 15 l-0.6 -0.6 l0.6 0.6 l-0.6 0.6" strokeWidth="0.6"/>
									  <path d="M23 13 l-0.6 -0.6 l0.6 0.6 l-0.6 0.6" strokeWidth="0.6"/>
									  {/* Most distant birds */}
									  <path d="M22 16 l-0.4 -0.4 l0.4 0.4 l-0.4 0.4" strokeWidth="0.5"/>
									  <path d="M24 14 l-0.4 -0.4 l0.4 0.4 l-0.4 0.4" strokeWidth="0.5"/>
									  <path d="M23 11 l-0.4 -0.4 l0.4 0.4 l-0.4 0.4" strokeWidth="0.5"/>
									  <path d="M25 12 l-0.4 -0.4 l0.4 0.4 l-0.4 0.4" strokeWidth="0.5"/>
									  <path d="M26 10 l-0.4 -0.4 l0.4 0.4 l-0.4 0.4" strokeWidth="0.5"/>
									</g>
								  </svg>
								  <h1 className="text-4xl font-bold text-gray-800 sm:text-5xl">
									Migrate to <span className="text-primary-500">Bluer Skies</span>
								  </h1>
							</div>
							<p className="text-xl text-gray-600 max-w-2xl mx-auto">
							  Tools to make switching from X to Bluesky easier
							  {' '}<a href="https://bsky.app" className="text-primary-600 hover:text-primary-700 font-medium" target="_blank" rel="noopener noreferrer">Go to Bluesky →</a>
							</p>
						</div>
                        <div className="bg-white rounded-2xl shadow-xl p-6 sm:p-8 space-y-8">
							{error && (
								<div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6">
									{error}
								</div>
							)}
							<div className="space-y-6">
								<div>
									<label className="block text-sm font-semibold text-gray-700 mb-2">Your X Username</label>
									<input
										type="text"
										className="w-full px-4 py-3 border border-gray-200 rounded-lg input-focus"
										placeholder="username (without @)"
										value={xUsername}
										onChange={handleUsernameChange}
									/>
									{xUsername && isVerified && (
										<div className="mt-2 text-green-600">
											✓ Verified with X
										</div>
									)}
									
									{verificationStatus && (
										<div className={verificationClass}>
											{verificationStatus}
										</div>
									)}
								</div>

								<div>
									<label className="block text-sm font-semibold text-gray-700 mb-2">Bluesky Handle</label>
									<input
										ref={targetHandleRef}
										type="text"
										className="w-full px-4 py-3 border border-gray-200 rounded-lg input-focus"
										placeholder="handle.bsky.social"
										value={targetHandle}
										onChange={handleTargetChange}
										onFocus={() => setTargetHandleFocused(true)}
										onBlur={() => setTargetHandleFocused(false)}
									/>
									{targetHandle && (
										<a href={generateDirectUrl()} 
										   target="_blank" 
										   rel="noopener noreferrer" 
										   className="text-sm text-primary-600 hover:text-primary-700 mt-2 inline-block">
											{generateDirectUrl()}
										</a>
									)}
								</div>
							</div>

                            {targetHandle && (
                                <div className="space-y-8 pt-6">
                                    <ShortLinkSection />
                                    
                                    {xUsername && (
                                        <>
                                            <div className="border-t pt-6">
                                                <h3 className="font-semibold text-gray-800 mb-3">Redirect Link</h3>
                                                <div className="flex items-center gap-2 bg-gray-50 p-4 rounded-lg border border-gray-200">
                                                    <code className="flex-1 font-mono text-sm break-all text-gray-700">
                                                        {generateRedirectUrl()}
                                                    </code>
                                                    <button
                                                        onClick={() => copyToClipboard(generateRedirectUrl())}
                                                        className="p-2 hover:bg-gray-200 rounded-full transition-colors duration-200"
                                                        title="Copy to clipboard"
                                                    >
                                                        <Copy size={18} className="text-gray-600" />
                                                    </button>
                                                </div>
                                            </div>

                                            <div className="space-y-8">
                                                <SnippetSection 
                                                    title="HTML Snippet"
                                                    code={generateHtmlSnippet(false)}
                                                    preview={generateHtmlSnippet(true)}
                                                />
                                                <SnippetSection 
                                                    title="Markdown Snippet"
                                                    code={generateMarkdownSnippet()}
                                                    preview={<a href={generateRedirectUrl()} className="text-primary-600 hover:text-primary-700">
                                                        Find me on {platform}
                                                    </a>}
                                                />
                                            </div>
                                        </>
                                    )}
                                </div>
                            )}

                            <div className="bg-white rounded-2xl shadow-xl p-6 sm:p-8">
                                <h2 className="text-2xl font-bold text-gray-800 mb-6">How it works</h2>
                                <ol className="list-decimal list-inside space-y-3 text-gray-600 ml-4">
                                    <li>Enter your X username and your Bluesky platform handle</li>
									<li>Optional: Sign in with X to validate ownership</li>
                                    <li>Copy your new redirect link or HTML/Markdown snippet</li>
                                    <li>Share it in your X bio or posts</li>
                                    <li>Visitors will be redirected to your new profile</li>
                                </ol>
                            </div>
                        </div>
                    </div>
					<ComingSoonSection />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SimpleRedirector />);
    </script>
	<script>
		const printColorfulX = () => {
			// ANSI escape codes for colors
			const colors = {
				blue: '\x1b[34m',
				cyan: '\x1b[36m',
				green: '\x1b[32m',
				red: '\x1b[31m',
				reset: '\x1b[0m',
				yellow: '\x1b[33m',
				magenta: '\x1b[35m'
			};

			// ASCII art for X Xer
			const xArt = [
				"\\    /  \\    /            ",
				" \\  /    \\  /    ___      ",
				"  \\/      \\/    |   \\     ",
				"  /\\      /\\    |___|     ",
				" /  \\    /  \\   |    \\    ",
				"/    \\  /    \\  |     \\   "
			];

			// Funny messages about the Twitter/X rebrand
			const messages = [
				"Because 'Twitter' was too many characters for a minimalist...",
				"Elon's keyboard got stuck on X - might as well roll with it!",
				"Maybe he just really likes playing Tic-Tac-Toe?",
				"When you accidentally hit X instead of Tweet and just commit to it",
				"Plot twist: The X stands for 'eXtremely expensive purchase'",
				"Because sometimes you need to X-plain yourself to shareholders",
				"X: Because 'Twitter User' was too mainstream",
				"X: When you're too X-tra for just one X",
				"The artist formerly known as Tweeter",
				"X: Because 'Social Media User' is so 2022"
			];

			// Print the X logo with random colors
			console.log('\nWelcome\n'); // Add some spacing
			xArt.forEach(line => {
				const randomColor = Object.values(colors)[Math.floor(Math.random() * (Object.keys(colors).length - 1))];
				console.log(`${randomColor}${line.padStart(30)}${colors.reset}`);
			});
			
			// Print random funny message
			const randomMessage = messages[Math.floor(Math.random() * messages.length)];
			console.log('\n' + colors.cyan + randomMessage + colors.reset + '\n');

			// Add a timestamp signature with X Xer branding
			const date = new Date().toLocaleDateString();
			console.log(colors.yellow + `X (formerly known as Twitter User) - ${date}` + colors.reset + '\n');
		};

		// Run the function
		printColorfulX();
	</script>
</body>
</html>
